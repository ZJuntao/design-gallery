<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åˆ†ç±»è¯¦æƒ…</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¨</text></svg>">
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>

  <div class="container">
    <a href="index.html" class="back-btn">â† è¿”å›</a>

    <header class="header">
      <h1 id="title" class="title"></h1>
    </header>

    <div id="gallery" class="grid"></div>
  </div>

  <div id="image-modal" class="modal" onclick="closeModal()">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modal-img" onclick="event.stopPropagation()">
    <a class="prev" onclick="prevImage(event)">&#10094;</a>
    <a class="next" onclick="nextImage(event)">&#10095;</a>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const name = params.get('name');
    let currentImages = [];
    let currentIndex = 0;

    document.getElementById('title').innerText = name;

    fetch('./gallery.json')
      .then(res => res.json())
      .then(data => {
        currentImages = data[name] || [];
        const container = document.getElementById('gallery');

        currentImages.forEach((item, index) => {
          const isObject = typeof item === 'object';
          const imgSrc = isObject ? item.thumbnail : item;
          
          const el = document.createElement('img');
          el.src = imgSrc;
          el.style.width = '100%';
          el.style.borderRadius = '12px';
          el.style.cursor = 'pointer';
          
          if (isObject && item.type === 'link') {
               // Mode 2: Open link
               el.onclick = () => window.open(item.url, '_blank');
               // Add an icon or indicator?
               el.title = "ç‚¹å‡»æŸ¥çœ‹3Dæ¡ˆä¾‹";
           } else {
              // Mode 1: Open Modal
              el.onclick = () => openModal(index);
          }
          
          container.appendChild(el);
        });
      });

    // Modal Logic
    function openModal(index) {
      const item = currentImages[index];
      if (typeof item === 'object') return; // Should not happen if logic above is correct

      if (index >= 0 && index < currentImages.length) {
        currentIndex = index;
        const modal = document.getElementById('image-modal');
        modal.style.display = "flex";
        updateModalImage();
      }
    }

    function closeModal() {
      document.getElementById('image-modal').style.display = "none";
    }

    function updateModalImage() {
      const img = document.getElementById('modal-img');
      img.src = currentImages[currentIndex];
    }

    function prevImage(e) {
      if (e) e.stopPropagation();
      currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
      updateModalImage();
    }

    function nextImage(e) {
      if (e) e.stopPropagation();
      currentIndex = (currentIndex + 1) % currentImages.length;
      updateModalImage();
    }

    // Keyboard navigation
    document.addEventListener('keydown', function (event) {
      if (document.getElementById('image-modal').style.display === 'flex') {
        if (event.key === "ArrowLeft") prevImage();
        if (event.key === "ArrowRight") nextImage();
        if (event.key === "Escape") closeModal();
      }
    });

    // Touch Swipe navigation
    let touchStartX = 0;
    let touchEndX = 0;

    const modalContent = document.getElementById('image-modal');

    modalContent.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    }, {
      passive: true
    });

    modalContent.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, {
      passive: true
    });

    function handleSwipe() {
      if (touchEndX < touchStartX - 50) nextImage();
      if (touchEndX > touchStartX + 50) prevImage();
    }
  </script>

</body>

</html>